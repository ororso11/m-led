<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INTECH LIGHTING - LED 조명 제품</title>
    <link rel="stylesheet" href="css/style.css">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
</head>
<body>
    <!-- 리스트 페이지 -->
    <div id="listPage">
        <div style="background: linear-gradient(to right, #1a1a1a 0%, #2c2c2c 100%);">
            <!-- 웹용 헤더 -->
            <div class="header-wrapper">
                <header>
                    <button class="mobile-menu-btn" onclick="toggleSidebar()">☰</button>
                    <div class="logo">INTECH LIGHTING</div>
                    <nav>
                        <a href="index.html">카탈로그</a>
                    </nav>
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="search">
                        <span>🔍</span>
                    </div>
                </header>
            </div>
        </div>

        <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

        <div class="container">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
                <h3>제품</h3>
                
                <!-- 동적 필터 컨테이너 -->
                <div id="dynamicFilters">
                    <!-- Firebase에서 카테고리를 동적으로 로드 -->
                </div>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <div class="breadcrumb">Home > 제품</div>
                <h1 class="page-title">제품</h1>

                <!-- 대분류 카테고리 (제품 리스트 상단) -->
                <div id="productTypeFilters" style="display: flex; justify-content: center; gap: 15px; margin-bottom: 30px; flex-wrap: wrap;">
                    <!-- JavaScript로 동적 생성 -->
                </div>

                <div class="product-grid" id="productGrid" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 20px;">
                    <!-- 제품들이 JavaScript로 자동 생성됩니다 -->
                    <div style="text-align: center; padding: 50px; color: #999; grid-column: 1 / -1;">
                        제품 데이터를 로딩 중입니다...
                    </div>
                </div>

                <!-- 페이징 -->
                <div id="pagination" style="display: flex; justify-content: center; align-items: center; gap: 10px; margin: 40px 0; flex-wrap: wrap;">
                    <!-- 페이지 버튼들이 JavaScript로 생성됩니다 -->
                </div>
            </main>
        </div>

        <!-- Footer -->
        <footer>
            <div class="footer-content">
                <div class="footer-section">
                    <h3>CONTACT</h3>
                    <p>영업1 전화번호 • 031-316-7300</p>
                    <p>영업2 전화번호 • 031-316-3800</p>
                    <p>A/S 전화번호 • 031-317-0725</p>
                    <p>FAX 전화번호 • 031-317-0726</p>
                </div>

                <div class="footer-section">
                    <h3>COMPANY</h3>
                    <p>(주)인테크라이팅</p>
                    <p>경기 시흥시 효현로 (경기 시흥시 대야동)</p>
                    <p>사업자등록번호 799-81-00657</p>
                </div>
                <div class="copyright">
                    COPYRIGHT © 2025 INTECH LIGHTING.<br>
                    ALL RIGHTS RESERVED. - 개발업체 : RECTOPS
                </div>
            </div>
        </footer>
    </div>

    <!-- 상세 페이지 -->
    <div id="detailPage" class="detail-page">
        <div class="detail-header">
            <button class="back-btn" onclick="goBack()">✕</button>
            <div class="detail-logo">INTECH LIGHTING<br><small style="font-size: 10px; letter-spacing: 2px;">SINCE 2025</small></div>
        </div>

        <div class="detail-content" id="detailContent">
            <!-- 상세 내용이 JavaScript로 자동 생성됩니다 -->
        </div>

        <!-- Footer -->
        <footer>
            <div class="footer-content">
                <div class="footer-section">
                    <h3>CONTACT</h3>
                    <p>영업1 전화번호 • 031-316-7300</p>
                    <p>영업2 전화번호 • 031-316-3800</p>
                    <p>A/S 전화번호 • 031-317-0725</p>
                    <p>FAX 전화번호 • 031-317-0726</p>
                </div>

                <div class="footer-section">
                    <h3>COMPANY</h3>
                    <p>(주)인테크라이팅</p>
                    <p>경기 시흥시 효현로 (경기 시흥시 대야동)</p>
                    <p>사업자등록번호 799-81-00657</p>
                </div>

                <div class="copyright">
                    COPYRIGHT © 2025 INTECH LIGHTING. ALL RIGHTS RESERVED.<br>
                    COPYRIGHT INFRINGEMENT OF THIS WORK IS STRICTLY PROHIBITED BY THE COPYRIGHT LAW.<br>
                    본 저작물은 무단사용 시 법적 책임을 물을 수 있습니다.
                </div>
            </div>
        </footer>
    </div>

    <!-- Firebase 설정 파일 -->
    <script src="js/firebase-config.js"></script>
    
    <script>
    // 전역 변수
    window.products = [];
    window.categories = {};

    console.log('Firebase 연결 시도 중...');

    // Firebase에서 카테고리 설정 로드
    database.ref('settings/categories').once('value', (snapshot) => {
        const data = snapshot.val();
        if (data) {
            window.categories = data;
            console.log('✅ 카테고리 로드 완료:', categories);
            
            // 대분류 버튼 생성
            if (categories.productType) {
                renderProductTypeButtons();
            }
            
            // 동적 필터 생성 (script.js의 함수 호출)
            if (typeof generateDynamicFilters === 'function') {
                generateDynamicFilters();
            }
        }
    });

    // 대분류 버튼 렌더링
    function renderProductTypeButtons() {
        const container = document.getElementById('productTypeFilters');
        if (!container || !categories.productType) return;
        
        container.innerHTML = categories.productType.values.map(type => `
            <button 
                class="product-type-btn ${type === 'ALL' ? 'active' : ''}" 
                data-type="${type}"
                onclick="selectProductType('${type}')"
                style="
                    padding: 12px 30px;
                    border: 2px solid ${type === 'ALL' ? '#333' : '#ddd'};
                    background: ${type === 'ALL' ? '#333' : 'white'};
                    color: ${type === 'ALL' ? 'white' : '#333'};
                    border-radius: 0;
                    cursor: pointer;
                    font-weight: ${type === 'ALL' ? 'bold' : 'normal'};
                    font-size: 14px;
                    transition: all 0.3s;
                "
            >
                ${type}
            </button>
        `).join('');
    }

    // 대분류 선택 (수정됨 - 반드시 resetToFirstPage 호출)
    window.selectProductType = function(type) {
        console.log('대분류 선택:', type);
        
        // 전역 변수에 설정
        if (typeof selectedFilters !== 'undefined') {
            selectedFilters.productType = type;
        } else {
            window.selectedFilters = { productType: type };
        }
        
        // 버튼 스타일 업데이트
        document.querySelectorAll('.product-type-btn').forEach(btn => {
            const isActive = btn.getAttribute('data-type') === type;
            btn.style.background = isActive ? '#333' : 'white';
            btn.style.color = isActive ? 'white' : '#333';
            btn.style.border = isActive ? '2px solid #333' : '2px solid #ddd';
            btn.style.fontWeight = isActive ? 'bold' : 'normal';
        });
        
        // script.js의 필터 함수 호출 - 반드시 실행되어야 함
        console.log('resetToFirstPage 호출 시도...');
        if (typeof resetToFirstPage === 'function') {
            resetToFirstPage();
            console.log('✅ resetToFirstPage 호출 완료');
        } else {
            console.error('❌ resetToFirstPage 함수를 찾을 수 없습니다!');
            // 대체 방법으로 직접 createProductCards 호출
            if (typeof createProductCards === 'function') {
                createProductCards();
                console.log('⚠️ createProductCards 직접 호출');
            }
        }
    }

    // Firebase에서 제품 데이터 로드
    database.ref('products').on('value', (snapshot) => {
        const data = snapshot.val();
        if (data) {
            window.products = [];
            Object.keys(data).forEach(key => {
                window.products.push({
                    ...data[key],
                    _key: key
                });
            });
            
            console.log('✅ Firebase 제품 데이터 로드:', products.length, '개');
            
            // script.js의 함수들 호출
            if (typeof createProductCards === 'function') {
                createProductCards();
            }
            if (typeof generateDynamicFilters === 'function') {
                generateDynamicFilters();
            }
            
        } else {
            window.products = [];
            const grid = document.getElementById('productGrid');
            if (grid) {
                grid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 100px 20px; color: #999;"><h3 style="font-size: 24px; margin-bottom: 15px;">등록된 제품이 없습니다</h3></div>';
            }
        }
    });

    // Firebase 연결 상태 모니터링
    database.ref('.info/connected').on('value', function(snapshot) {
        if (snapshot.val() === true) {
            console.log('✅ Firebase 실시간 연결 활성화');
        } else {
            console.log('⚠️ Firebase 연결 끊김');
        }
    });
    </script>
    
    <!-- 기존 script.js (상세페이지 기능 등) -->
    <script src="js/script.js"></script>
</body>
</html>